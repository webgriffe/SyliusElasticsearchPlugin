{
    "attributes": {
        "nested": {
            "path": "attributes"
        },
        "aggs": {
            "filtered-attributes": {
                "filter": {
                    "bool": {
                        "filter": [
                            {
                                "term": {
                                    "attributes.filterable": true
                                }
                            }
                        ]
                    }
                },
                "aggs": {
                    "attribute": {
                        "terms": {
                            "field": "attributes.code",
                            "size": 1000,
                            "min_doc_count": 1
                        },
                        "aggs": {
                            "values": {
                                "terms": {
                                    "field": {{ ('attributes.values.' ~ localeCode ~ '.values')|json_encode|raw }},
                                    "size": 1000
                                }
                            },
                            "label": {
                                "terms": {
                                    "field": {{ ('attributes.name.' ~ localeCode)|json_encode|raw }},
                                    "size": 1
                                }
                            }
                        }
                    }
                }
            }
        },
        "meta": {
            "type": "{{ constant('\\Webgriffe\\SyliusElasticsearchPlugin\\Model\\AttributeFilter::TYPE') }}"
        }
    }
}
